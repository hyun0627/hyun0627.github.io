<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì¸ë””ì–¸ í¬ì»¤</title>
  <style>
    html, body { margin:0; padding:0; height:100%; }
    body {
      width: 100vw;
      height: 100vh;
      min-height:100vh;
      background: #1b8834;
      user-select:none;
      font-family: 'Segoe UI', 'Roboto', 'Arial', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .table {
      box-shadow: 0 0 32px #073413a7;
      background: #18703a;
      border-radius: 51px;
      width: 800px; min-width: 340px; min-height: 570px; /* ì¤„ì„ */
      padding: 0 10px; position: relative;
      border: 16px solid #5d3e11;
      display: flex; flex-direction: column; align-items:center; justify-content: center;
    }
    .chipstack { position: absolute; top: 18px; left: 37px; z-index: 300; display: flex; flex-direction: column; align-items: flex-start; }
    .chips { display: flex; align-items: center; font-size:23px; background:none; border:none; box-shadow:none; margin-bottom:10px; font-weight:bold; }
    .chipicon.mychip {
      width:29px; height:29px; display:inline-block; border-radius:50%; background:radial-gradient(circle,#fa4b67 60%,#9d1828 98%); border:2.5px solid #ffcbcb;box-shadow: 0 3px 12px #d8113142, 0 1px #ffd9d9;
      margin-right:9px; margin-left:2px;
    }
    .chipicon.opchip {
      width:29px; height:29px; display:inline-block; border-radius:50%; background:radial-gradient(circle,#343434 69%,#111 99%); border:2.5px solid #ececec; box-shadow: 0 4px 11px #2224, 0 2px #fff4;
      margin-right:9px; margin-left:2px;
    }
    .namearea {
      text-align:center;font-size:32px;font-weight:bold;margin:7px 0 16px 0;letter-spacing:2px;color:#fff;text-shadow:1px 1px 3px #000b;
    }
    .deckarea {
      margin: 0 auto 7px auto; /* ì¤„ì„ */
      min-height: 90px;
      min-width: 140px;
      display:flex;justify-content:center;align-items:center;
      transition: margin 0.18s;
    }
    .deck-card {
      width:80px; height:120px; border-radius:13px; background:#222c; position:relative;
      display:flex; align-items:center; justify-content:center; font-size:2.2em; box-shadow:0 6px 16px #222a;
      border:4px solid #fff; z-index:111;
      transition: transform 0.5s cubic-bezier(.22,1.03,.48,.87);
    }
    .cardrow {
      gap:20px; display:flex; justify-content:center; min-height:170px;
    }
    .cardarea {
      min-width:168px;
      margin-bottom: 7px;
      margin-top: 7px;
    }
    #p2area { margin-top: 9px !important; }
    #p1area { margin-bottom: 9px !important; }
    .cardstack {display:flex;gap:19px;justify-content:center;}
    .card {
      width:92px;height:144px;border-radius:17px;background:#fff;border:3.5px solid #222;box-shadow:0 8px 20px #0005,inset 0 2px #fafafa3b;display:flex;align-items:center;justify-content:center;font-size:2.5em;font-weight:bold;color:#192d40;position:relative;transition:.22s;
    }
    .card.back {
      background: repeating-linear-gradient(135deg,#0041b9 0 8px,#fff 8px 12px,#ffba06 12px 18px,#0031a0 18px 30px);
      position:relative; overflow:hidden;
      border:3.5px solid #db0707;
      border-style: double;
      box-shadow:0 0 0 3px #fff, 0 4px 22px #1118;
    }
    .card.back::before {
      content: "";
      position: absolute;
      left:50%; top: 50%;
      width: 36px; height:36px;
      background: radial-gradient(circle,#ffe889 60%,#ede86a 87%,#ba7d02 100%);
      border-radius:41%;
      border:2px solid #c77b0c;
      box-shadow:0 0 9px #ffdc87e6;
      transform:translate(-50%,-50%);
      z-index:2;
      opacity:.83;
    }
    .card.face {background:linear-gradient(120deg,#fff,#e6f3ea 60% 100%);}
    .card.chosen {border:4.5px solid #c9203a!important;box-shadow: 0 0 0 7px #ff386062;z-index:4;}
    .cardreveal {font-size:21px;margin:13px;color:#ffda68;text-shadow:0 2px 8px #000b}
    .betrow {display:flex;justify-content:center;gap:42px;margin:35px 0 18px 0;}
    .btn {font-size:1.18em;font-weight:bold;min-width:99px;padding:12px 18px;margin:0 8px; border-radius:13px;border:none;cursor:pointer;transition:.22s;background:#f8f5e2;box-shadow:0 4px 13px #0d2a13a6;}
    .btn.bet {background:linear-gradient(115deg,#ffde8a,#ee5560 80%);color:#783014; border:2.5px solid #f8db8e;}
    .btn.die {background:linear-gradient(115deg,#c0e1f9,#1584b2 80%); color:#26325c;border:2.5px solid #b6cadb;}
    .btn.again {background:linear-gradient(91deg,#ffe9c7,#ffb677); color:#b46d17; border:2.5px solid #f1c784;}
    .gameinfo { width:100%;margin: 21px auto 13px auto; text-align:center;font-size:27px;color:#fffef7; text-shadow:0 1px 15px #000c,0 2px 8px #111a; }
    .bet-history {text-align:center;color:#cdeffd;font-size:17px;margin:7px 0 1px 0;min-height:32px;}
  </style>
</head>
<body>
<div class='table' id='table' style='position:relative;'>
  <div class='chipstack'>
    <div class='chips' id='p1chips'><span class='chipicon mychip'></span>ë‚´ ì¹©: <span id='p1_chip_val'>10</span></div>
    <div class='chips' id='p2chips'><span class='chipicon opchip'></span>ìƒëŒ€ ì¹©: <span id='p2_chip_val'>10</span></div>
  </div>
  <div style='display:flex;flex-direction:column;align-items:center;width:100%;'>
    <div class='cardarea' id='p2area' style='margin-top:30px;'>
      <div class='namearea'>ìƒëŒ€</div>
      <div class='cardstack' id='p2cards'></div>
      <div class='cardreveal' id='p2reveal'></div>
    </div>
    <div class='deckarea' id='centerdeck'>
      <div class='deck-card' id='deckcard1'>ğŸ‚ </div>
      <div class='deck-card' id='deckcard2' style='margin-left:-46px;'>ğŸ‚ </div>
    </div>
    <div class='cardarea' id='p1area' style='margin-bottom:30px;'>
      <div class='namearea'>ë‚˜</div>
      <div class='cardstack' id='p1cards'></div>
      <div class='cardreveal' id='p1reveal'></div>
    </div>
  </div>
  <div class='gameinfo' id='gameinfo'>ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤!</div>
  <div class='bet-history' id='bethistory'></div>
  <div class='betrow' id='actionrow' style='display:none;'>
    <button class='btn' id='openbtn' style='display:none;'>ì¹´ë“œ ê³µê°œ</button>
    <button class='btn bet' id='betbtn'>ë² íŒ…</button>
    <button class='btn die' id='diebtn'>ë‹¤ì´</button>
  </div>
  <div style='width: 98%;display:flex;justify-content:center;'><button class='btn again' id='againbtn' style='display:none;margin-top:17px;'>ë‹¤ìŒ ê²Œì„</button></div>
</div>
<script>
// ì¹´ë“œ/ì¹©/ê²Œì„ ìƒíƒœ ë°ì´í„°
const SUITS = ['â™ ','â™¥','â™£','â—†'];
const CARDNUMS = [2,3,4,5,6,7,8,9,10]; // A/K/Q/J ì œì™¸
let p1Chips = 10, p2Chips = 10;
let deck, p1Hand, p2Hand, p1Visible, p2Visible;
let betPhase = 0, maxPhase = 3, betHistory = [], gameover = false;
let p1Chosen = false, p2Chosen = false;

function buildDoubleDeck() {
  let cards = [];
  for (let x = 0; x < 2; x++) {
    for (let s of SUITS) for (let n of CARDNUMS) cards.push({s, n});
  }
  for (let i = cards.length - 1; i > 0; i--) {
    let j = Math.floor(Math.random() * (i + 1));
    [cards[i], cards[j]] = [cards[j], cards[i]];
  }
  return cards;
}

// ì¹´ë“œ ë”œ(ë°°ë¶„) ì• ë‹ˆë©”ì´ì…˜
function dealCardsAnim(cb) {
  const deck1 = document.getElementById('deckcard1');
  const deck2 = document.getElementById('deckcard2');
  deck1.style.visibility='visible';
  deck2.style.visibility='visible';
  // ì´ˆê¸° ì¹´ë“œ ìˆ¨ê¹€
  document.getElementById('p1cards').style.opacity=0.3;
  document.getElementById('p2cards').style.opacity=0.3;
  setTimeout(()=>{
    deck1.style.transform='translate(0px,260px) scale(1.08)'; // ë‚˜ì—ê²Œ ì´ë™í•˜ëŠ” ëŠë‚Œ
    deck2.style.transform='translate(0px,-260px) scale(1.06)'; // ìƒëŒ€ì—ê²Œ ì´ë™í•˜ëŠ” ëŠë‚Œ
    setTimeout(()=>{
      deck1.style.visibility='hidden';deck2.style.visibility='hidden';
      document.getElementById('p1cards').style.opacity=1;
      document.getElementById('p2cards').style.opacity=1;
      deck1.style.transform='';deck2.style.transform='';
      if(cb) cb();
    }, 700);
  }, 350);
}

function initGame() {
  if (!window._mainDeck) window._mainDeck = buildDoubleDeck();
  deck = window._mainDeck;

  if (deck.length < 4) {
    // ë± ì†Œì§„ ì‹œ ìµœì¢… ì¹© ìŠ¹ë¶€
    endGameByChips();
    return;
  }
  p1Hand = [deck.pop(), deck.pop()];
  p2Hand = [deck.pop(), deck.pop()];
  p1Visible = null;
  p2Visible = null;
  betPhase = 0;
  gameover = false;
  betHistory = [];
  p1Chosen = false;
  p2Chosen = false;
  renderHands();
  renderChips();
  document.getElementById('gameinfo').textContent = 'ê°ì í•œ ì¥ ê³µê°œí•  ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”!';
  document.getElementById('actionrow').style.display = 'none';
  document.getElementById('againbtn').style.display = 'none';
  document.getElementById('bethistory').innerHTML = '';
  document.getElementById('p1reveal').textContent = '';
  document.getElementById('p2reveal').textContent = '';
  // ë±ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜
  document.getElementById('deckcard1').style.visibility = 'visible';
  document.getElementById('deckcard2').style.visibility = 'visible';
  document.getElementById('deckcard1').style.transform = '';
  document.getElementById('deckcard2').style.transform = '';
  setTimeout(() => {
    dealCardsAnim(() => {});
  }, 150);
}

function endGameByChips() {
  let msg;
  if (p1Chips > p2Chips) msg = 'ëª¨ë“  ì¹´ë“œ ì†Œì§„! ë‚´ ì¹©ì´ ë” ë§ìœ¼ë¯€ë¡œ <b>ìµœì¢… ìŠ¹ë¦¬!</b>';
  else if (p1Chips < p2Chips) msg = 'ëª¨ë“  ì¹´ë“œ ì†Œì§„! ìƒëŒ€ ì¹©ì´ ë” ë§ì•„ <b>íŒ¨ë°°!</b>';
  else msg = 'ëª¨ë“  ì¹´ë“œ ì†Œì§„! ì¹©ì´ ê°™ìœ¼ë¯€ë¡œ <b>ë¬´ìŠ¹ë¶€</b>!';
  document.getElementById('gameinfo').innerHTML = msg;
  document.getElementById('actionrow').style.display = 'none';
  document.getElementById('againbtn').style.display = 'none';
  // ë‹¤ì‹œ ì‹œì‘ ìœ„í•´ deck ë° ì¹© ì´ˆê¸°í™” ì˜µì…˜ ì•ˆë‚´
  setTimeout(() => {
    document.getElementById('bethistory').innerHTML = 'ìƒˆ ê²Œì„ì„ ì‹œì‘í•˜ë ¤ë©´ ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ì¹©/ì¹´ë“œ ìƒíƒœë¥¼ ë¦¬ì…‹í•˜ì„¸ìš”!';
  }, 100);
}

// ì¹´ë“œ ë Œë” í•¨ìˆ˜
function renderHand(area, hand, reveal, canChoose, chosenIdx, showAll) {
  area.innerHTML = '';
  hand.forEach((card,i)=>{
    let div = document.createElement('div');
    // showAllì´ë©´ í•­ìƒ ê³µê°œ
    const shown = showAll || reveal[i];
    div.className = 'card ' + (shown ? 'face' : 'back') + (canChoose?'':' disabled') + (chosenIdx===i?' chosen':'');
    div.innerHTML = shown ? (card.n+"<span style='font-size:.66em;'>"+card.s+"</span>") : '';
    if(showAll && chosenIdx===i) {
      // ë‚´ ìª½ì—ì„œ ê³µê°œì¹´ë“œëŠ” ê°•ì¡°
      div.className += ' chosen';
    }
    if(showAll && canChoose && chosenIdx!==i) {
      div.title = 'ë‚´ê°€ ìƒëŒ€ì—ê²Œ ë³´ì—¬ì£¼ì§€ ì•Šì€ ì¹´ë“œ (ë‚˜ë§Œ ë³¼ ìˆ˜ ìˆìŒ)';
    }
    if (canChoose) {
      div.style.cursor='pointer';
      div.onclick = ()=>chooseHandCard(i,area.id==='p1cards');
    }
    area.appendChild(div);
  });
}

function renderHands() {
  // ìƒëŒ€ì˜ ì¹´ë“œ (ê¸°ì¡´ëŒ€ë¡œ)
  let p2RevealArr = [false,false];
  if (p2Visible!==null) p2RevealArr[p2Visible]=true;
  renderHand(document.getElementById('p2cards'), p2Hand, p2RevealArr, false, p2Visible, false);
  // ë‚´ ì¹´ë“œ: í•­ìƒ ë‘ ì¥ ë‹¤ í‘œì‹œ, ê³µê°œì¹´ë“œëŠ” í…Œë‘ë¦¬ë¡œ, ë¹„ê³µê°œ ì¹´ë“œëŠ” ì´ˆë¡í…Œë‘ë¦¬/ê°•ì¡° ì—†ì´
  let canChoose = !p1Chosen && !gameover && p1Visible===null;
  renderHand(document.getElementById('p1cards'), p1Hand, [true,true], canChoose, p1Visible, true);
}

function chooseHandCard(idx, isMe) {
  if (isMe && !p1Chosen && p1Visible===null) {
    p1Visible = idx; p1Chosen=true; renderHands();
    document.getElementById('p1reveal').textContent = 'ìƒëŒ€ì—ê²Œ ì´ ì¹´ë“œë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤!';
    setTimeout(()=>{
      checkBothReveal();
    },1200);
  }
}

function checkBothReveal() {
  if(p1Visible!==null && p2Visible===null){
    // NPC ì„ íƒ: ì „ëµ, ë” ë†’ì€ ì¹´ë“œ(show)ê°€ ë³´ì´ê²Œ!
    p2Visible = p2Hand[0].n >= p2Hand[1].n ? 0 : 1;
    p2Chosen = true; renderHands();
    document.getElementById('p2reveal').textContent = 'ë‚´ê°€ ë³´ì—¬ì¤€ ì¹´ë“œ!';
  }
  if(p1Visible!==null && p2Visible!==null){
    document.getElementById('gameinfo').textContent = 'ë² íŒ…/ë‹¤ì´ ì„ íƒ (3ë¼ìš´ë“œ)';
    betPhase=1;
    document.getElementById('actionrow').style.display='flex';
    showBetButtons();
    renderHands();
  }
}

function renderChips() {
  document.getElementById('p1_chip_val').textContent = p1Chips;
  document.getElementById('p2_chip_val').textContent = p2Chips;
}

function showBetButtons() {
  document.getElementById('betbtn').style.display = !gameover ? '' : 'none';
  document.getElementById('diebtn').style.display = !gameover ? '' : 'none';
  document.getElementById('openbtn').style.display = 'none';
}

function logBet(player, action) {
  betHistory.push(`<span style='color:${player?"#fd6767":"#5ec8ef"};font-weight:bold'>${player?"ë‚˜":"ìƒëŒ€"}</span>: ${action}`);
  document.getElementById('bethistory').innerHTML = betHistory.join(' | ');
}

function playerAction(bet) {
  if(gameover) return;
  if(bet){
    logBet(true, 'ë² íŒ…');
    nextNpcAction();
  } else {
    logBet(true, 'ë‹¤ì´');
    finishGame(false);
  }
}

function nextNpcAction() {
  setTimeout(()=>{
    // NPC ë² íŒ…/ë‹¤ì´ ë¡œì§: Showì¹´ë“œ+ë‚¨ì€ ë² íŒ…ìˆ˜+í™•ë¥  ê¸°ë°˜
    let shown = p1Hand[p1Visible].n;
    let mySum = p2Hand[0].n + p2Hand[1].n;
    let oppSum = '?'; // ìƒëŒ€ëŠ” ëª¨ë¥´ë‹ˆê¹Œ
    let confidence = (p2Hand[p2Visible].n + shown) / 2;
    let probRaise = Math.min(1, (confidence-2.5)/7 + (betPhase-1)*0.13);
    let bet = Math.random()<probRaise;
    logBet(false, bet?'ë² íŒ…':'ë‹¤ì´');
    if(!bet) finishGame(true);
    else nextBetPhase();
  },800);
}

function nextBetPhase() {
  betPhase++;
  if(betPhase>maxPhase){
    // ê³µê°œ+ìŠ¹ë¶€
    finishGame();
  }
}

function finishGame(npcFolded) {
  document.getElementById('actionrow').style.display='none';
  gameover=true;
  document.getElementById('againbtn').style.display='inline-block';
  let mySum = p1Hand[0].n + p1Hand[1].n;
  let opSum = p2Hand[0].n + p2Hand[1].n;
  let outcome = '';
  if(npcFolded===true) {outcome = 'ìƒëŒ€ê°€ ë‹¤ì´! ë‚´ê°€ ìŠ¹ë¦¬!'; p1Chips++; p2Chips--;}
  else if(npcFolded===false) {outcome = 'ë‚´ê°€ ë‹¤ì´! ìƒëŒ€ ìŠ¹ë¦¬!'; p1Chips--; p2Chips++;}
  else if(mySum>opSum){ outcome='ìµœì¢… ì˜¤í”ˆ! ë‚´ê°€ ìŠ¹ë¦¬!'; p1Chips+=2; p2Chips-=2;}
  else if(mySum<opSum){ outcome='ìµœì¢… ì˜¤í”ˆ! ìƒëŒ€ ìŠ¹ë¦¬!'; p1Chips-=2; p2Chips+=2;}
  else outcome='ë¬´ìŠ¹ë¶€!';

  document.getElementById('gameinfo').innerHTML = `${outcome}<br>(ë‚´ í•©: <b>${mySum}</b> / ìƒëŒ€ í•©: <b>${opSum}</b>)`;
  renderChips();
  revealAllHands();
}

function revealAllHands() {
  // ë‹¤ ê³µê°œ (face)
  renderHand(document.getElementById('p1cards'), p1Hand, [true,true], false);
  renderHand(document.getElementById('p2cards'), p2Hand, [true,true], false);
  document.getElementById('p1reveal').textContent = '';
  document.getElementById('p2reveal').textContent = '';
}

// ë²„íŠ¼ ë° ì´ë²¤íŠ¸ ì—°ê²°
function registerEvents() {
  document.getElementById('betbtn').onclick = () => playerAction(true);
  document.getElementById('diebtn').onclick = () => playerAction(false);
  document.getElementById('openbtn').onclick = () => finishGame();
  document.getElementById('againbtn').onclick = () => {
    initGame();
  };
}

registerEvents();
initGame();
</script>
</body>
</html>
